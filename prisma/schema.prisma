// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// =======================
// USER
// =======================
model User {
  id       Int    @id @default(autoincrement())
  username String @db.VarChar(100)
  email    String @unique @db.VarChar(150)
  password String @db.VarChar(100)
  tasks Task[]
  activitys Activity[]
  activiti Activiti[]
  moneys Money[]
  dailyGoals DailyTarget[]
  focus Focus[]
  schedules Schedule[]
  categories Category[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

// =======================
// TASK (Ada Difficulty)
// =======================
model Task {
  id          Int      @id @default(autoincrement())
  title       String   @db.VarChar(100)
  description String   @db.Text
  
  // Field penting yang diminta
  difficulty  String   @db.VarChar(20) // Easy, Medium, Hard
  priority    String   @db.VarChar(10) // High, Low
  
  due_date    DateTime
  status      String   @db.VarChar(20) // ToDo, Done

  // Relations
  user_id     Int
  user        User     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  
  schedule    Schedule[]

  @@map("tasks")
}

// =======================
// ACTIVITY (Ada Start/End Time) Gary
// =======================
model Activity {
  id            Int      @id @default(autoincrement())
  title         String   @db.VarChar(100)
  description   String   @db.Text
  
  // Activity pakai durasi waktu, bukan cuma due_date
  startDateTime DateTime
  endDateTime   DateTime
  
  // Relations
  user_id       Int
  user          User     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  
  schedule      Schedule[]

  @@map("activitys")
}

// =======================
// ACTIVITY (Ada Start/End Time) Deus
// =======================
model Activiti {
  id          Int    @id @default(autoincrement())
  title       String @db.VarChar(100)
  description String @db.Text
  start_date  String @db.VarChar(100)
  end_date    String @db.VarChar(100)
  start_time  String @db.VarChar(100)
  end_time    String @db.VarChar(100)
  // schedule Schedule[]

  user_id Int

  user User @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
    @@map("activityis")
}




model Category {
  id      Int    @id @default(autoincrement())
  user_id Int
  budget  Int
  name    String @db.VarChar(100)

  user    User   @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  moneys  Money[]

  @@map("money_categories")
}

//Sudah
model Money{
  id          Int    @id @default(autoincrement())
  title       String @db.VarChar(100)
  description String @db.Text
  amount Int 
  type String @db.VarChar(20) //Income atau Outcome
  createdAt DateTime @default(now())
  category_id Int?
  category    Category? @relation(fields: [category_id], references: [id], onDelete: SetNull, onUpdate: Cascade)
  user_id Int
  user User @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@map("moneys")
}

// =======================
// FOCUS
// =======================
model Focus {
  id          Int      @id @default(autoincrement())
  startTime   DateTime
  endTime     DateTime
  phases      FocusPhase[]
  createdAt   DateTime @default(now())

  user_id     Int
  user        User     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@map("focus")
}

model FocusPhase {
  id        Int    @id @default(autoincrement())
  focus_id  Int
  focus     Focus  @relation(fields: [focus_id], references: [id], onDelete: Cascade)
  type      String @db.VarChar(30) // Focus atau Break
  duration  Int
  
  @@map("focusphases")
}

// =======================
// TARGETS & GOALS
// =======================
model DailyTarget {
  id        Int      @id @default(autoincrement())
  user_id   Int
  user      User     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  date      DateTime
  focusGoal Int
  taskGoal  Int
  createdAt DateTime @default(now())

  @@unique([user_id, date])
  @@map("dailytargets")
}


//Belum
model Schedule {
  id          Int  @id @default(autoincrement())

  // Dibuat Optional (?) agar jadwal bisa diisi Task SAJA atau Activity SAJA
  activity_id Int?
  activity    Activity? @relation(fields: [activity_id], references: [id])
  
  task_id     Int?
  task        Task?     @relation(fields: [task_id], references: [id])

  user_id     Int
  user        User      @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@map("schedules")
}